/*
 * subject_director
 */
insert into tm.subject_director(subject_id, teacher_id) values('0101', '01048');
insert into tm.subject_director(subject_id, teacher_id) values('0103', '01043');
insert into tm.subject_director(subject_id, teacher_id) values('0104', '01023');
insert into tm.subject_director(subject_id, teacher_id) values('0105', '01146');
insert into tm.subject_director(subject_id, teacher_id) values('0106', '01048'); -- 已停招
insert into tm.subject_director(subject_id, teacher_id) values('0107', '01023');
insert into tm.subject_director(subject_id, teacher_id) values('0108', '01048'); -- 已停招
insert into tm.subject_director(subject_id, teacher_id) values('0191', '01048'); -- 已停招
insert into tm.subject_director(subject_id, teacher_id) values('0193', '01043');
insert into tm.subject_director(subject_id, teacher_id) values('0194', '01023'); -- 已停招
insert into tm.subject_director(subject_id, teacher_id) values('0202', '02082');
insert into tm.subject_director(subject_id, teacher_id) values('0203', '02057');
insert into tm.subject_director(subject_id, teacher_id) values('0204', '02002');
insert into tm.subject_director(subject_id, teacher_id) values('0206', '02002');
insert into tm.subject_director(subject_id, teacher_id) values('0207', '02094');
insert into tm.subject_director(subject_id, teacher_id) values('0401', '04086');
insert into tm.subject_director(subject_id, teacher_id) values('0402', '04096'); -- 已停招
insert into tm.subject_director(subject_id, teacher_id) values('0403', '04058'); -- 已停招
insert into tm.subject_director(subject_id, teacher_id) values('0405', '04096'); -- 已停招
insert into tm.subject_director(subject_id, teacher_id) values('0406', '04096');
insert into tm.subject_director(subject_id, teacher_id) values('0407', '04058');
insert into tm.subject_director(subject_id, teacher_id) values('0408', '04065');
insert into tm.subject_director(subject_id, teacher_id) values('0492', '04096'); -- 已停招
insert into tm.subject_director(subject_id, teacher_id) values('0493', '04065'); -- 已停招
insert into tm.subject_director(subject_id, teacher_id) values('0494', '04065');
insert into tm.subject_director(subject_id, teacher_id) values('0501', '05104');
insert into tm.subject_director(subject_id, teacher_id) values('0503', '05027'); -- 已停招
insert into tm.subject_director(subject_id, teacher_id) values('0504', '05104');
insert into tm.subject_director(subject_id, teacher_id) values('0505', '05027'); -- 已停招
insert into tm.subject_director(subject_id, teacher_id) values('0506', '05027');
insert into tm.subject_director(subject_id, teacher_id) values('0507', '05027');
insert into tm.subject_director(subject_id, teacher_id) values('0508', '05104');
insert into tm.subject_director(subject_id, teacher_id) values('0701', '07066');
insert into tm.subject_director(subject_id, teacher_id) values('0702', '07022');
insert into tm.subject_director(subject_id, teacher_id) values('0703', '07068');
insert into tm.subject_director(subject_id, teacher_id) values('0704', '07033');
insert into tm.subject_director(subject_id, teacher_id) values('0791', '07066');
insert into tm.subject_director(subject_id, teacher_id) values('0502', '08010');
insert into tm.subject_director(subject_id, teacher_id) values('0801', '08010');
insert into tm.subject_director(subject_id, teacher_id) values('0807', '08068');
insert into tm.subject_director(subject_id, teacher_id) values('0809', '08170');
insert into tm.subject_director(subject_id, teacher_id) values('0811', '08080'); -- 已停招
insert into tm.subject_director(subject_id, teacher_id) values('0812', '08262');
insert into tm.subject_director(subject_id, teacher_id) values('0813', '08223'); -- 已停招
insert into tm.subject_director(subject_id, teacher_id) values('0814', '08223');
insert into tm.subject_director(subject_id, teacher_id) values('0815', '04063');
insert into tm.subject_director(subject_id, teacher_id) values('0816', '08080');
insert into tm.subject_director(subject_id, teacher_id) values('0817', '08262');
insert into tm.subject_director(subject_id, teacher_id) values('0818', '08010');
insert into tm.subject_director(subject_id, teacher_id) values('0891', '08080'); -- 已停招
insert into tm.subject_director(subject_id, teacher_id) values('1001', '10061');
insert into tm.subject_director(subject_id, teacher_id) values('1002', '10010');
insert into tm.subject_director(subject_id, teacher_id) values('1004', '66005');
insert into tm.subject_director(subject_id, teacher_id) values('1094', '66005');
insert into tm.subject_director(subject_id, teacher_id) values('1101', '11054');
insert into tm.subject_director(subject_id, teacher_id) values('1103', '11084');
insert into tm.subject_director(subject_id, teacher_id) values('1191', '11054');
insert into tm.subject_director(subject_id, teacher_id) values('1201', '12025'); -- 已停招
insert into tm.subject_director(subject_id, teacher_id) values('1202', '12025');
insert into tm.subject_director(subject_id, teacher_id) values('1203', '12022');
insert into tm.subject_director(subject_id, teacher_id) values('1204', '12041');
insert into tm.subject_director(subject_id, teacher_id) values('1205', '12025');
insert into tm.subject_director(subject_id, teacher_id) values('1291', '12025'); -- 已停招
insert into tm.subject_director(subject_id, teacher_id) values('1293', '12022');
insert into tm.subject_director(subject_id, teacher_id) values('0810', '08030');
insert into tm.subject_director(subject_id, teacher_id) values('1301', '13213'); -- 已停招
insert into tm.subject_director(subject_id, teacher_id) values('1302', '13213'); -- 已停招
insert into tm.subject_director(subject_id, teacher_id) values('1303', '13213'); -- 已停招
insert into tm.subject_director(subject_id, teacher_id) values('1304', '13061');
insert into tm.subject_director(subject_id, teacher_id) values('1305', '13213'); -- 已停招
insert into tm.subject_director(subject_id, teacher_id) values('1306', '13010');
insert into tm.subject_director(subject_id, teacher_id) values('1307', '03005');
insert into tm.subject_director(subject_id, teacher_id) values('1308', '13145');
insert into tm.subject_director(subject_id, teacher_id) values('1309', '13213');
insert into tm.subject_director(subject_id, teacher_id) values('1310', '13040');
insert into tm.subject_director(subject_id, teacher_id) values('1311', '13040');
insert into tm.subject_director(subject_id, teacher_id) values('1312', '08030');
insert into tm.subject_director(subject_id, teacher_id) values('1313', '13040');
insert into tm.subject_director(subject_id, teacher_id) values('1501', '15026');
insert into tm.subject_director(subject_id, teacher_id) values('1502', '15112');
insert into tm.subject_director(subject_id, teacher_id) values('1503', '15026'); -- 已停招
insert into tm.subject_director(subject_id, teacher_id) values('1504', '15026');
insert into tm.subject_director(subject_id, teacher_id) values('1505', '15112');
insert into tm.subject_director(subject_id, teacher_id) values('1591', '15026');
insert into tm.subject_director(subject_id, teacher_id) values('1701', '17025');
insert into tm.subject_director(subject_id, teacher_id) values('1702', '03058');
insert into tm.subject_director(subject_id, teacher_id) values('1703', '95029'); -- 已停招
insert into tm.subject_director(subject_id, teacher_id) values('1704', '95029'); -- 已停招
insert into tm.subject_director(subject_id, teacher_id) values('1705', '95029');
insert into tm.subject_director(subject_id, teacher_id) values('1706', '95029');
insert into tm.subject_director(subject_id, teacher_id) values('1801', '18007');
insert into tm.subject_director(subject_id, teacher_id) values('1802', '18202');
insert into tm.subject_director(subject_id, teacher_id) values('1805', '18105');
insert into tm.subject_director(subject_id, teacher_id) values('1806', '18004');
insert into tm.subject_director(subject_id, teacher_id) values('1891', '18007'); -- 已停招
insert into tm.subject_director(subject_id, teacher_id) values('1895', '18105');
insert into tm.subject_director(subject_id, teacher_id) values('2002', '06086'); -- 已停招
insert into tm.subject_director(subject_id, teacher_id) values('2006', '03005');
insert into tm.subject_director(subject_id, teacher_id) values('2007', '06042');
insert into tm.subject_director(subject_id, teacher_id) values('2008', '03032');
insert into tm.subject_director(subject_id, teacher_id) values('2009', '20044'); -- 已停招
insert into tm.subject_director(subject_id, teacher_id) values('2010', '03032');
insert into tm.subject_director(subject_id, teacher_id) values('2011', '20021'); -- 已停招
insert into tm.subject_director(subject_id, teacher_id) values('2012', '20021');
insert into tm.subject_director(subject_id, teacher_id) values('2013', '20044');
insert into tm.subject_director(subject_id, teacher_id) values('2014', '06086');
insert into tm.subject_director(subject_id, teacher_id) values('2015', '20021');
insert into tm.subject_director(subject_id, teacher_id) values('2101', '21001');
insert into tm.subject_director(subject_id, teacher_id) values('2191', '21001');
insert into tm.subject_director(subject_id, teacher_id) values('2201', '20049');

/**
 * user - sys
 * scheme
 */
--drop table tm.scheme_course cascade constraints;
--drop table tm.scheme_field cascade constraints;
--drop table scheme_temp_course cascade constraints;
--drop table tm.scheme_template_property cascade constraints;
--drop table tm.scheme_template_term cascade constraints;
--drop table scheme_template cascade constraints;
--drop table scheme cascade constraints;

delete tm.scheme_course;
delete tm.scheme;
delete tm.scheme_template_property;
delete tm.scheme_template;


-- 方案模板
insert into tm.scheme_template (id, name, description)
values(1, '2012级模板', '具有小学期');

-- 方案模板-课程性质
insert into tm.scheme_template_property(scheme_template_id, property_id, property_template, display_order, has_directions, ordered_courses)
values(1, 1, '1', 1, 0, '["9311008.", "9311009.", "9311007.", "9311010.", "9311005.", "151100..", "9411....", "9211....", "681000.."]');
insert into tm.scheme_template_property(scheme_template_id, property_id, property_template, display_order, has_directions, ordered_courses)
values(1, 4, '1', 2, 0, null);
insert into tm.scheme_template_property(scheme_template_id, property_id, property_template, display_order, has_directions, ordered_courses)
values(1, 9, '1', 3, 0, null);
insert into tm.scheme_template_property(scheme_template_id, property_id, property_template, display_order, has_directions, ordered_courses)
values(1, 5, '2', 4, 1, null);
insert into tm.scheme_template_property(scheme_template_id, property_id, property_template, display_order, has_directions, ordered_courses)
values(1, 7, '1', 5, 0, null);
insert into tm.scheme_template_property(scheme_template_id, property_id, property_template, display_order, has_directions, ordered_courses)
values(1, 13, '3', 6, 0, null);
insert into tm.scheme_template_property(scheme_template_id, property_id, property_template, display_order, has_directions, ordered_courses)
values(1, 2, '3', 7, 0, null);

-- 方案模板-学期
insert into tm.scheme_template_term(scheme_template_id, term, display_order, title) values(1,  1,  1, '一');
insert into tm.scheme_template_term(scheme_template_id, term, display_order, title) values(1,  2,  2, '二');
insert into tm.scheme_template_term(scheme_template_id, term, display_order, title) values(1, 17,  3, '小1');
insert into tm.scheme_template_term(scheme_template_id, term, display_order, title) values(1,  3,  4, '三');
insert into tm.scheme_template_term(scheme_template_id, term, display_order, title) values(1,  4,  5, '四');
insert into tm.scheme_template_term(scheme_template_id, term, display_order, title) values(1, 18,  6, '小2');
insert into tm.scheme_template_term(scheme_template_id, term, display_order, title) values(1,  5,  7, '五');
insert into tm.scheme_template_term(scheme_template_id, term, display_order, title) values(1,  6,  8, '六');
insert into tm.scheme_template_term(scheme_template_id, term, display_order, title) values(1, 19,  9, '小3');
insert into tm.scheme_template_term(scheme_template_id, term, display_order, title) values(1,  7, 10, '七');
insert into tm.scheme_template_term(scheme_template_id, term, display_order, title) values(1,  8, 11, '八');

--  培养方案-目标与规格
insert into tm.program_vision (objective, specification, los_description, program_id)
select ' ', ' ', ' ', p.id
from ea.program p
join ea.major m on m.id = p.major_id
where m.grade >= 2012 and substr(p.id, -1, 1) <> '9' -- 除去2012级以前的辅修
order by p.id;


--  培养方案-教学安排
insert into tm.scheme (version_number, status, program_id, scheme_template_id, creator_id, date_created)
select power(2, 24), 4, p.id, 1, teacher_id, sysdate
from ea.program p
join ea.major m on m.id = p.major_id
join tm.subject_director sd on sd.subject_id = m.subject_id
where m.grade >= 2012 and substr(p.id, -1, 1) <> '9' -- 除去2012级以前的辅修
order by p.id;

-- 方案-课程
insert into tm.scheme_course(practice_credit, period_theory, period_experiment, period_weeks,
is_compulsory, is_practical, property_id, assess_type, suggested_term, allowed_term,
direction_id, course_id, scheme_id)
select 0 as practice_credit, 
pc.period_theory, pc.period_experiment, pc.period_weeks,
pc.is_compulsory, pc.is_practical, pc.property_id,
pc.assess_type, pc.suggested_term, pc.allowed_term,
pc.direction_id, pc.course_id, (select id from tm.scheme
where program_id = pc.program_id) as scheme_id
from ea.program_course pc
join ea.program p on p.id = pc.program_id
join ea.major m on m.id = p.major_id
where m.grade >= 2012 and substr(p.id, -1, 1) <> '9' -- 除去2012级以前的辅修
and (program_id, nvl(direction_id, 0)) not in (
(201201010, 201201011), -- 2012计算机专业含国际课程班方向
(201310010, 201310012)  -- 2013级法学专业英美法方向
) 
order by p.id, suggested_term, course_id;

update tm.scheme_course set allowed_term = 126, practice_credit = 1 where course_id = '93110082'; -- 思想道德修养与法律基础2
update tm.scheme_course set allowed_term = 126 where course_id = '93110090'; -- 中国近现代史纲要
update tm.scheme_course set allowed_term = 126 where course_id = '93110070'; -- 马克思主义基本原理
update tm.scheme_course set allowed_term = 126 where course_id = '93110101'; -- 毛泽东思想和中国特色社会主义理论体系概论(理论)
update tm.scheme_course set allowed_term = 65536, suggested_term = 17, practice_credit = 2 where course_id = '93110102'; -- 毛泽东思想和中国特色社会主义理论体系概论(实践)
update tm.scheme_course set allowed_term = 255 where course_id = '93110050'; -- 形势与政策 1-8学期
update tm.scheme_course set practice_credit = 1 where course_id = '94110000'; -- 军事教育

update tm.scheme_course set period_theory = 1 where course_id = '68100030'; -- 大学生职业规划与就业指导
update tm.scheme_course set period_theory = 1 where course_id = '20190530'; -- 研究方法






-- 错误数据
delete from zfxfzb.jxjhkcxxb where jxjhh = '20122006' and kcdm = '06190340' and kcxz = '个性课程';

merge into tm.scheme_course a
using (select 0 as practice_credit, 
pc.period_theory, pc.period_experiment, pc.period_weeks,
pc.is_compulsory, pc.is_practical, pc.property_id,
pc.assess_type, pc.suggested_term, pc.allowed_term,
pc.direction_id, pc.course_id, (select id from tm.scheme
where program_id = pc.program_id) as scheme_id
from ea.program_course pc
join ea.program p on p.id = pc.program_id
join ea.major m on m.id = p.major_id
where m.grade >= 2012 and substr(p.id, -1, 1) <> '9' -- 除去2012级以前的辅修
and (program_id, nvl(direction_id, 0)) not in (
(201201010, 201201011), -- 2012计算机专业含国际课程班方向
(201310010, 201310012)  -- 2013级法学专业英美法方向
)) b
on (a.scheme_id = b.scheme_id and a.course_id = b.course_id 
and nvl(a.direction_id, 0) = nvl(b.direction_id, 0))
when matched then
update set
a.allowed_term = b.allowed_term,
a.assess_type = b.assess_type,
a.is_compulsory = b.is_compulsory,
a.is_practical = b.is_practical,
a.period_experiment = b.period_experiment,
a.period_weeks = b.period_weeks,
a.period_theory = b.period_theory,
a.practice_credit = b.practice_credit,
a.property_id = b.property_id,
a.suggested_term = b.suggested_term
when not matched then
insert (allowed_term, assess_type, is_compulsory, is_practical, period_experiment, 
period_weeks, period_theory, practice_credit, property_id, suggested_term,
scheme_id, course_id, direction_id)
values (b.allowed_term, b.assess_type, b.is_compulsory, b.is_practical, b.period_experiment, 
b.period_weeks, b.period_theory, b.practice_credit, b.property_id, b.suggested_term,
b.scheme_id, b.course_id, b.direction_id);

